<!DOCTYPE html> 
<html lang="it"> 
<head> 
    <meta charset="UTF-8"> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> 
    <title>Delivery Sprint - Lele Conte</title> 
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
    <style> 
        /* DESIGN & COLOR PALETTE */ 
        :root { 
            --bg-gradient: linear-gradient(135deg, #0f0c29, #302b63, #24243e); 
            --primary: #ffffff; 
            --accent: #00d2ff; 
            --danger: #ff4757; 
            --success: #2ecc71;
            --text: #ffffff; 
            --white: #ffffff; 
            --gold: #ffcc00;
            --glass: rgba(255, 255, 255, 0.1);
        } 

        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            font-family: 'Montserrat', sans-serif; 
            user-select: none; 
            touch-action: auto; /* Cambiato per permettere lo scroll */
        } 

        body { 
            background: var(--bg-gradient); 
            color: var(--text); 
            overflow: hidden; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            transition: filter 0.3s;
        } 

        /* SCHERMATA LOGIN */
        #auth-screen {
            position: absolute;
            width: 100%;
            height: 100%;
            background: var(--bg-gradient);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 300;
            text-align: center;
        }

        .auth-box {
            background: var(--glass);
            padding: 40px;
            border-radius: 30px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            width: 90%;
            max-width: 400px;
        }

        input[type="text"] {
            width: 100%;
            padding: 15px;
            margin-top: 20px;
            border-radius: 15px;
            border: none;
            background: rgba(255,255,255,0.1);
            color: white;
            text-align: center;
            font-size: 1.2rem;
            outline: none;
            border: 1px solid rgba(255,255,255,0.2);
        }

        /* SCHERMATA PRINCIPALE RINNOVATA */ 
        #main-menu { 
            position: absolute; 
            width: 100%; 
            height: 100%; 
            background: var(--bg-gradient); 
            display: none; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            z-index: 100; 
            text-align: center; 
            padding: 20px; 
        } 

        .logo-container {
            font-size: 4rem;
            margin-bottom: 10px;
            animation: pulse 2s infinite ease-in-out;
            filter: drop-shadow(0 0 15px var(--accent));
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 0.8; }
        }

        .game-title {
            font-size: 2.8rem;
            font-weight: 800;
            background: linear-gradient(to bottom, #fff, #00d2ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 4px;
            margin-bottom: 5px;
        }

        .user-welcome {
            background: rgba(0, 210, 255, 0.15);
            padding: 8px 20px;
            border-radius: 12px;
            border: 1px solid var(--accent);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 25px;
            color: var(--accent);
            font-weight: 600;
        }

        .author { 
            font-size: 0.8rem; 
            color: var(--white); 
            margin-bottom: 30px; 
            opacity: 0.5; 
            font-weight: 400; 
            letter-spacing: 1px;
        } 

        .balance-tag {
            background: rgba(0,0,0,0.3);
            padding: 12px 30px;
            border-radius: 50px;
            border: 2px solid var(--gold);
            color: var(--gold);
            font-weight: 800;
            font-size: 1.6rem;
            margin-bottom: 35px;
            box-shadow: 0 0 15px rgba(255, 204, 0, 0.2);
        }

        .menu-buttons { 
            display: flex; 
            flex-direction: column; 
            gap: 15px; 
            width: 100%; 
            max-width: 320px; 
        } 

        button { 
            padding: 18px 30px; 
            font-size: 1rem; 
            border: none; 
            border-radius: 15px; 
            cursor: pointer; 
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            font-weight: 700; 
            text-transform: uppercase;
            letter-spacing: 1px;
        } 

        .btn-play { 
            background: linear-gradient(90deg, #00d2ff, #3a7bd5);
            color: white; 
            box-shadow: 0 10px 20px rgba(0, 210, 255, 0.3);
        } 

        .btn-shop {
            background: var(--glass);
            color: var(--white);
            border: 1px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
        }

        .btn-settings { 
            background: transparent;
            color: rgba(255,255,255,0.4);
            font-size: 0.8rem;
            margin-top: 10px;
        } 

        button:hover { transform: translateY(-3px); opacity: 0.9; }
        button:active { transform: scale(0.95); } 

        /* MODALI */ 
        .modal { 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            background: rgba(15, 12, 41, 0.98); 
            padding: 30px; 
            border-radius: 30px; 
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 25px 50px rgba(0,0,0,0.8); 
            z-index: 200; 
            display: none; 
            width: 90%; 
            max-width: 450px; 
            backdrop-filter: blur(25px);
        } 

        .shop-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            max-height: 50vh;
            overflow-y: auto; /* Permette lo scroll */
            -webkit-overflow-scrolling: touch; /* Scroll fluido su iOS */
            padding-right: 5px;
            margin: 20px 0;
            touch-action: pan-y; /* Permette solo lo scroll verticale touch */
        }

        .shop-item {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 20px;
            cursor: pointer;
            text-align: center;
            border: 2px solid transparent;
            transition: 0.3s;
        }

        .shop-item.selected { border-color: var(--accent); background: rgba(0, 210, 255, 0.1); }
        .shop-item.affordable { border-color: var(--success); background: rgba(46, 204, 113, 0.15); }
        .shop-item.locked { opacity: 0.5; }
        .shop-item img { width: 50px; height: 50px; object-fit: contain; margin-bottom: 10px; }

        /* AREA DI GIOCO */ 
        #game-container { 
            position: relative; 
            width: 100vw; 
            height: 100vh; 
            background: #1a1a1a; 
            display: none; 
        } 

        #hud { 
            position: absolute; 
            top: 30px; 
            left: 20px; 
            right: 20px; 
            display: flex; 
            justify-content: space-between; 
            pointer-events: none; 
            z-index: 10; 
        } 

        .stat-box { 
            background: var(--glass);
            backdrop-filter: blur(10px);
            padding: 12px 20px; 
            border-radius: 20px; 
            border: 1px solid rgba(255,255,255,0.1);
            font-weight: 700;
        } 

        #mobile-controls { 
            position: absolute; 
            bottom: 40px; 
            left: 30px; 
            right: 30px; 
            display: none; 
            justify-content: space-between; 
            z-index: 10; 
        } 

        .nav-btn { 
            width: 85px; 
            height: 85px; 
            background: var(--glass);
            backdrop-filter: blur(10px);
            border-radius: 25px; 
            border: 1px solid rgba(255,255,255,0.2); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            color: white; 
            font-size: 2rem; 
        } 
    </style> 
</head> 
<body> 

    <div id="auth-screen">
        <div class="auth-box">
            <div class="logo-container">üöö</div>
            <h1 style="letter-spacing: 5px; margin-bottom: 10px;">HELLO!</h1>
            <p style="opacity: 0.6; font-size: 0.8rem;">Carica il tuo profilo conducente</p>
            <input type="text" id="username-input" placeholder="Il tuo Nome..." maxlength="15">
            <button class="btn-play" style="width: 100%; margin-top: 25px;" onclick="handleLogin()">Accedi al Terminale</button>
        </div>
    </div>

    <div id="main-menu"> 
        <div class="logo-container">‚ö°</div>
        <h1 class="game-title">DELIVERY SPRINT</h1> 
        <div id="user-display" class="user-welcome">CONDUCENTE: <span id="user-name-label">...</span></div>
        
        <div class="balance-tag">$ <span id="menu-cash">0</span></div>
          
        <div class="menu-buttons"> 
            <button class="btn-play" id="btn-start" onclick="startGame()">Avvia Motore</button> 
            <button class="btn-shop" onclick="toggleModal('shop-modal')">Garage Personale</button> 
            <button class="btn-settings" id="btn-sett" onclick="toggleModal('settings-modal')">Impostazioni</button> 
        </div> 

        <p class="author" style="margin-top: 40px;">powered by <b>Lele Conte</b></p> 
    </div> 

    <div id="shop-modal" class="modal">
        <h2 style="text-align:center; letter-spacing: 2px;">IL TUO GARAGE</h2>
        <div class="shop-grid" id="shop-list"></div>
        <button class="btn-play" style="width:100%" onclick="toggleModal('shop-modal')">Chiudi Garage</button>
    </div>

    <div id="settings-modal" class="modal"> 
        <h2 id="settings-title" style="margin-bottom: 20px; text-align:center;">SISTEMA</h2> 
        
        <div style="display: flex; flex-direction: column; gap: 15px;">
            <div class="setting-row">
                <label id="label-lang">Lingua:</label>
                <select id="lang-select" onchange="updateLanguage()" style="width: 100%; padding: 10px; background: #222; color: white; border-radius: 8px;">
                    <option value="it">Italiano</option>
                    <option value="en">English</option>
                </select>
            </div>
            <div class="setting-row">
                <label id="label-diff">Difficolt√†:</label>
                <select id="diff-select" style="width: 100%; padding: 10px; background: #222; color: white; border-radius: 8px;">
                    <option value="0.5">Easy</option>
                    <option value="1" selected>Normal</option>
                    <option value="2">Hardcore</option>
                </select>
            </div>
        </div>

        <p style="margin: 20px 0; font-size: 0.7rem; opacity: 0.4; text-align:center;">Versione 1.1.0 (2026)</p> 
        <button class="btn-shop" style="width: 100%;" onclick="toggleModal('settings-modal')">Applica</button> 
    </div> 

    <div id="game-container"> 
        <div id="hud"> 
            <div class="stat-box"><span id="hud-score-text">Punti</span>: <span id="score">0</span></div> 
            <div class="stat-box"><span id="hud-speed">0</span> KM/H</div> 
        </div> 

        <canvas id="gameCanvas"></canvas> 

        <div id="mobile-controls"> 
            <div class="nav-btn" id="leftBtn">‚Üê</div> 
            <div class="nav-btn" id="rightBtn">‚Üí</div> 
        </div> 
    </div> 

    <script> 
        const canvas = document.getElementById('gameCanvas'); 
        const ctx = canvas.getContext('2d'); 
        const mainMenu = document.getElementById('main-menu'); 
        const gameContainer = document.getElementById('game-container'); 
        const mobileControls = document.getElementById('mobile-controls'); 
        const authScreen = document.getElementById('auth-screen');

        let currentUser = "";
        let userMoney = 0;
        let unlocked = ['bike'];
        let currentVehicle = 'bike';

        window.onload = () => {
            const lastUser = localStorage.getItem('ds_last_session');
            if(lastUser) {
                document.getElementById('username-input').value = lastUser;
                handleLogin();
            }
        };

        function handleLogin() {
            const input = document.getElementById('username-input').value.trim();
            if(!input) { alert("Per favore, inserisci un nome."); return; }
            
            currentUser = input;
            localStorage.setItem('ds_last_session', currentUser);
            const savedData = localStorage.getItem(`ds_user_${currentUser.toLowerCase()}`);
            
            if(savedData) {
                const data = JSON.parse(savedData);
                userMoney = data.cash;
                unlocked = data.unlocked;
                currentVehicle = data.vehicle;
            } else {
                userMoney = 0;
                unlocked = ['bike'];
                currentVehicle = 'bike';
                saveSession();
            }

            authScreen.style.display = 'none';
            mainMenu.style.display = 'flex';
            document.getElementById('user-name-label').innerText = currentUser;
            renderShop();
        }

        const vehicles = {
            bike: { name: "BMX", img: "https://cdn-icons-png.flaticon.com/512/3163/3163174.png", price: 0, speed: 6 },
            moped: { name: "Scooter", img: "https://cdn-icons-png.flaticon.com/512/1710/1710183.png", price: 2000, speed: 8 },
            motocross: { name: "Cross", img: "https://cdn-icons-png.flaticon.com/512/3503/3503831.png", price: 10000, speed: 10 },
            compact: { name: "City Car", img: "https://cdn-icons-png.flaticon.com/512/744/744465.png", price: 25000, speed: 11 },
            truck: { name: "Truck", img: "https://cdn-icons-png.flaticon.com/512/2555/2555013.png", price: 60000, speed: 12 },
            superbike: { name: "Superbike", img: "https://cdn-icons-png.flaticon.com/512/3503/3503798.png", price: 120000, speed: 15 },
            supercar: { name: "Hypercar", img: "https://cdn-icons-png.flaticon.com/512/808/808439.png", price: 500000, speed: 20 }
        };

        const houseImg = new Image(); houseImg.src = 'https://cdn-icons-png.flaticon.com/512/619/619153.png'; 
        const holeImg = new Image(); holeImg.src = 'https://cdn-icons-png.flaticon.com/512/6122/6122394.png'; 

        let gameActive = false; let score = 0; let roadOffset = 0; let currentSpeed = 5; let accelerationTimer = 0; let potholes = []; 
        const player = { x: 0, y: 0, w: 60, h: 60, targetX: 0 }; const target = { x: 0, y: -200, w: 60, h: 60 }; const buildings = []; 
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent); 

        function toggleModal(id) {
            const m = document.getElementById(id);
            m.style.display = (m.style.display === 'block') ? 'none' : 'block';
            if(id === 'shop-modal') renderShop();
        }

        function updateLanguage() {
            const lang = document.getElementById('lang-select').value;
            const t = {
                it: { start: "Avvia Motore", score: "Punti", lang: "Lingua:", diff: "Difficolt√†:", title: "SISTEMA" },
                en: { start: "Start Engine", score: "Score", lang: "Language:", diff: "Difficulty:", title: "SYSTEM" }
            };
            document.getElementById('btn-start').innerText = t[lang].start;
            document.getElementById('hud-score-text').innerText = t[lang].score;
            document.getElementById('label-lang').innerText = t[lang].lang;
            document.getElementById('label-diff').innerText = t[lang].diff;
            document.getElementById('settings-title').innerText = t[lang].title;
        }

        function renderShop() {
            const shop = document.getElementById('shop-list');
            shop.innerHTML = '';
            for(let id in vehicles) {
                const v = vehicles[id];
                const isOwned = unlocked.includes(id);
                const isAffordable = !isOwned && userMoney >= v.price;
                
                let statusClass = "";
                if (isOwned) { statusClass = (currentVehicle === id ? 'selected' : ''); } 
                else if (isAffordable) { statusClass = 'affordable'; } 
                else { statusClass = 'locked'; }

                shop.innerHTML += `
                    <div class="shop-item ${statusClass}" onclick="handleShopClick('${id}')">
                        <img src="${v.img}">
                        <small style="display:block; margin-bottom:5px;">${v.name}</small>
                        <b style="color:${isAffordable ? 'var(--success)' : 'var(--gold)'}; font-size:0.8rem;">
                            ${isOwned ? (currentVehicle === id ? 'ATTIVO' : 'USA') : '$'+v.price.toLocaleString()}
                        </b>
                    </div>
                `;
            }
            document.getElementById('menu-cash').innerText = userMoney.toLocaleString();
        }

        function handleShopClick(id) {
            if (unlocked.includes(id)) {
                currentVehicle = id;
            } else if (userMoney >= vehicles[id].price) {
                userMoney -= vehicles[id].price;
                unlocked.push(id);
                currentVehicle = id;
            }
            saveSession();
            renderShop();
        }

        function saveSession() {
            if(!currentUser) return;
            const data = { cash: userMoney, unlocked: unlocked, vehicle: currentVehicle };
            localStorage.setItem(`ds_user_${currentUser.toLowerCase()}`, JSON.stringify(data));
        }

        function init() { 
            canvas.width = window.innerWidth; 
            canvas.height = window.innerHeight; 
            player.x = canvas.width / 2 - player.w / 2; 
            player.targetX = player.x; 
            player.y = canvas.height - 140; 
            currentSpeed = vehicles[currentVehicle].speed;
            accelerationTimer = 0;
            score = 0;
            potholes = [];
            document.getElementById('score').innerText = score;
            buildings.length = 0; 
            for(let i=0; i<8; i++) spawnBuilding(i/8); 
            spawnDelivery(); 
        } 

        function spawnBuilding(z) { 
            const side = Math.random() > 0.5; 
            buildings.push({ 
                side: side, 
                z: z || 0, 
                h: 150 + Math.random() * 200, 
                w: 100 + Math.random() * 50, 
                color: `hsl(210, 20%, ${15 + Math.random() * 10}%)` 
            }); 
        } 

        function spawnDelivery() { 
            target.x = (Math.random() - 0.5) * (canvas.width * 0.4); 
            target.y = -600; 
        }

        function spawnPothole() {
            const diff = parseFloat(document.getElementById('diff-select').value);
            if(Math.random() < 0.01 * diff) {
                potholes.push({ x: (Math.random() - 0.5) * (canvas.width * 0.4), y: -100 });
            }
        }

        function startGame() { 
            mainMenu.style.display = 'none'; 
            gameContainer.style.display = 'block'; 
            if (isMobile) mobileControls.style.display = 'flex'; 
            gameActive = true; 
            init(); 
            animate(); 
        } 

        function gameOver(msg) {
            gameActive = false;
            const reward = score * 50;
            userMoney += reward;
            saveSession();
            alert(`${msg}! Incasso: $${reward}`);
            gameContainer.style.display = 'none';
            mobileControls.style.display = 'none';
            mainMenu.style.display = 'flex';
            document.getElementById('menu-cash').innerText = userMoney.toLocaleString();
            renderShop();
        }

        const keys = {}; 
        window.addEventListener('keydown', e => keys[e.key] = true); 
        window.addEventListener('keyup', e => keys[e.key] = false); 

        document.getElementById('leftBtn').ontouchstart = (e) => { e.preventDefault(); keys['a'] = true; }; 
        document.getElementById('leftBtn').ontouchend = () => keys['a'] = false; 
        document.getElementById('rightBtn').ontouchstart = (e) => { e.preventDefault(); keys['d'] = true; }; 
        document.getElementById('rightBtn').ontouchend = () => keys['d'] = false; 

        function update() { 
            if (!gameActive) return; 
            accelerationTimer++;
            if(accelerationTimer % 60 === 0) currentSpeed += 0.05;
            let moveFactor = 10 + (currentSpeed * 0.5);
            if (keys['ArrowLeft'] || keys['a']) player.targetX -= moveFactor; 
            if (keys['ArrowRight'] || keys['d']) player.targetX += moveFactor; 
            player.x += (player.targetX - player.x) * 0.15; 
            const roadLimit = canvas.width * 0.15; 
            if (player.x < roadLimit || player.x > canvas.width - roadLimit - player.w) gameOver("INCIDENTE"); 
            roadOffset += currentSpeed; 
            buildings.forEach(b => { 
                b.z += currentSpeed * 0.002; 
                if(b.z > 1.2) { b.z = 0; b.h = 150 + Math.random() * 200; } 
            }); 
            target.y += currentSpeed; 
            if(target.y > canvas.height) spawnDelivery(); 
            spawnPothole();
            potholes.forEach((p, i) => {
                p.y += currentSpeed;
                if(p.y > canvas.height) potholes.splice(i, 1);
                const pDist = Math.hypot(player.x + player.w/2 - (canvas.width/2 + p.x), player.y + player.h/2 - p.y);
                if(pDist < 40) gameOver("FOSSO PRESO");
            });
            const dist = Math.hypot(player.x + player.w/2 - (canvas.width/2 + target.x), player.y - target.y); 
            if(dist < 55) { 
                score++; currentSpeed += 0.2; 
                document.getElementById('score').innerText = score; 
                spawnDelivery(); 
            } 
            document.getElementById('hud-speed').innerText = Math.floor(currentSpeed * 10);
        } 

        function draw() { 
            ctx.clearRect(0, 0, canvas.width, canvas.height); 
            ctx.fillStyle = "#2c3e50"; 
            ctx.beginPath(); 
            ctx.moveTo(canvas.width * 0.45, 0); 
            ctx.lineTo(canvas.width * 0.55, 0); 
            ctx.lineTo(canvas.width * 0.9, canvas.height); 
            ctx.lineTo(canvas.width * 0.1, canvas.height); 
            ctx.fill(); 
            ctx.strokeStyle = "rgba(255,255,255,0.5)"; 
            ctx.setLineDash([40, 40]); 
            ctx.lineDashOffset = -roadOffset; 
            ctx.beginPath(); 
            ctx.moveTo(canvas.width/2, 0); 
            ctx.lineTo(canvas.width/2, canvas.height); 
            ctx.stroke(); 
            ctx.setLineDash([]); 
            buildings.sort((a,b) => b.z - a.z).forEach(b => { 
                const scale = b.z; 
                const xPos = b.side ? (canvas.width/2 + (canvas.width * 0.1 * (1/scale))) : (canvas.width/2 - (canvas.width * 0.1 * (1/scale)) - b.w * scale); 
                const yPos = canvas.height * (1 - scale); 
                ctx.fillStyle = b.color; 
                ctx.fillRect(xPos, yPos, b.w * scale, b.h * scale); 
            }); 
            potholes.forEach(p => { ctx.drawImage(holeImg, canvas.width/2 + p.x - 20, p.y - 20, 40, 40); });
            ctx.drawImage(houseImg, canvas.width/2 + target.x - 30, target.y, 60, 60); 
            const vImg = new Image();
            vImg.src = vehicles[currentVehicle].img;
            ctx.drawImage(vImg, player.x, player.y, player.w, player.h); 
        } 

        function animate() { 
            update(); draw(); 
            if (gameActive) requestAnimationFrame(animate); 
        } 
        window.addEventListener('resize', init); 
    </script> 
</body> 
</html>
